<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">

  <link rel="stylesheet" href="/css/main.css">
  <link href="https://fonts.googleapis.com/css?family=Lato:300,700|Raleway:300,300i,700,700i" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.rawgit.com/konpa/devicon/df6431e323547add1b4cf45992913f15286456d3/devicon.min.css">

  <script defer src="https://use.fontawesome.com/releases/v5.8.1/js/all.js" integrity="sha384-g5uSoOSBd7KkhAMlnQILrecXvzst9TdC09/VM+pjDTCM+1il8RHz5fKANTFFb+gQ" crossorigin="anonymous"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded",function(){
      let node = document.querySelector('.preload-transitions');
      node.classList.remove('preload-transitions');
    });
  </script>

  <link rel="alternate" type="application/rss+xml" title="Development Simplified" href="/feed.xml">

  <!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Configure Puma SSL for local development on Ubuntu | Development Simplified</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Configure Puma SSL for local development on Ubuntu" />
<meta name="author" content="Josh Frankel (@joshmfrankel)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Having your development environment match production helps ensure that a feature works the same in both contexts. An example of when local SSL is beneficial is whenever you are dealing with hardware specific permissions such as a webcam or microphone. This tutorial is specifically for Debian based Linux on the lvh.me domain for Google Chrome but it could also be used in other contexts." />
<meta property="og:description" content="Having your development environment match production helps ensure that a feature works the same in both contexts. An example of when local SSL is beneficial is whenever you are dealing with hardware specific permissions such as a webcam or microphone. This tutorial is specifically for Debian based Linux on the lvh.me domain for Google Chrome but it could also be used in other contexts." />
<link rel="canonical" href="http://joshfrankel.me/blog/configure-puma-ssl-for-local-development-on-ubuntu/" />
<meta property="og:url" content="http://joshfrankel.me/blog/configure-puma-ssl-for-local-development-on-ubuntu/" />
<meta property="og:site_name" content="Development Simplified" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-11-29T00:00:00+00:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Josh Frankel (@joshmfrankel)"},"description":"Having your development environment match production helps ensure that a feature works the same in both contexts. An example of when local SSL is beneficial is whenever you are dealing with hardware specific permissions such as a webcam or microphone. This tutorial is specifically for Debian based Linux on the lvh.me domain for Google Chrome but it could also be used in other contexts.","headline":"Configure Puma SSL for local development on Ubuntu","dateModified":"2018-11-29T00:00:00+00:00","datePublished":"2018-11-29T00:00:00+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://joshfrankel.me/blog/configure-puma-ssl-for-local-development-on-ubuntu/"},"url":"http://joshfrankel.me/blog/configure-puma-ssl-for-local-development-on-ubuntu/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="theme-color" content="#61b8d0"/>
</head>

  <body class="preload-transitions">
    <header class="Container Container-flex Container--smallMargin">

  <a href="/" class="Logo-container">
    <img src="/img/layout/josh-frankel-author.jpg" class="Logo Logo-avatar" alt="Josh Frankel (Author)" />
    <div class="Logo Logo-logo">
      <span class="Logo Logo-first-name">Development</span>
      <span class="Logo Logo-last-name">Simplified</span>
    </div>
  </a>

  <nav class="flex-right">
    
      
      <a href="/blog" >Blog</a>
    
      
      <a href="/blog/categories" >Categories</a>
    
      
      <a href="/blog/tags" >Tags</a>
    
      
      <a href="/blog/archives" >Archives</a>
    
      
      <a href="/" >About</a>
    
  </nav>
</header>


    <div class="Banner">
  <div class="Container Container-flex Container--wrap">
    <h1 class="Banner-heading">Configure Puma SSL for local development on Ubuntu</h1>

    
      <p class="Banner-information">
        <time>November 29, 2018</time>
      </p>
    
  </div>
</div>


    <div class="Content Container Container-flex">
      <article class="Post">
  





  <p>Having your development environment match production helps ensure that a feature works the same in both contexts. An example of when local SSL is beneficial is whenever you are dealing with hardware specific permissions such as a webcam or microphone. This tutorial is specifically for Debian based Linux on the lvh.me domain for Google Chrome but it could also be used in other contexts.
<!--excerpt--></p>

<p>Before we go further, I’d first like to give thanks to the following article <a href="https://leehblue.com/add-self-signed-ssl-google-chrome-ubuntu-16-04/">Add Self-Signed SSL To Google Chrome on Ubuntu 16.04</a>. It helped me to figure out how to enable local SSL. The following tutorial differs from the above in a few key ways:</p>

<ul>
  <li>It specifically details how to run SSL Sockets with Puma on Ruby on Rails</li>
  <li>It doesn’t require Nginx to be installed</li>
  <li>It describes how to configure the lvh.me domain for a self-signed certificate</li>
</ul>

<h2 id="generating-a-self-signed-certificate">Generating a Self-Signed Certificate</h2>

<p>First let’s create a new working directory for your current project</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cd </span>project
<span class="nb">mkdir</span> .ssl</code></pre></figure>

<blockquote class="Info Info-right"><strong>What is a self-signed certificate</strong><br />
In cryptography and computer security, a self-signed certificate is an identity certificate that is signed by the same entity whose identity it certifies.
<br />
<cite><a href="https://en.wikipedia.org/wiki/Self-signed_certificate">- Wikipedia</a></cite>
</blockquote>

<p>Now Ubuntu ships with an openssl configuration file which we’ll use to help us generate a self-signed certificate.</p>

<p>Let’s find our <strong>openssl.cnf</strong> file, copy it, and modify it to include our specific local domain. We create a copy to keep the original intact and also to allow us to add <code class="highlighter-rouge">*.lvh.me</code> as an alternative internal domain name.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cp</span> /etc/ssl/openssl.cnf /project/.ssl

<span class="c"># Begin editing the copy at /project/.ssl/openssl.cnf</span>
<span class="c"># Add the following v3_ca extension to the end of the [ v3_req ] section</span>

<span class="o">[</span> v3_req <span class="o">]</span>
<span class="c"># many other settings</span>
x509_extensions <span class="o">=</span> v3_ca

<span class="c"># Add to end of [ v3_ca ] section the alt_names for internal domains we are planning on using</span>

<span class="o">[</span>v3_ca]
<span class="c"># more settings</span>
subjectAltName <span class="o">=</span> @alt_names
<span class="o">[</span>alt_names]
DNS.1 <span class="o">=</span> <span class="k">*</span>.lvh.me
DNS.2 <span class="o">=</span> lvh.me</code></pre></figure>

<p>Now we can run the <code class="highlighter-rouge">openssl</code> command for generating the certificate for our project. I’ve named the <strong>.key</strong> and <strong>.crt</strong> files to correspond to the <strong>lvh_me</strong> domain but really they only need to be named something you’ll remember.</p>

<p><strong>Note</strong> When running the command below it will ask you a series of questions. Most can be skipped by pressing enter. When asked for the <abbr title="Fully qualified domain name">FQDN</abbr> you’ll need to specify <code class="highlighter-rouge">*.lvh.me</code>. This tells the certificate what domain or in the case above wildcard subdomains to be valid for.</p>

<p><strong>Note</strong> You may also want to use a different authority name than the default <strong>org-Internet Widgits Pty Ltd</strong> in case it already exists. You can check to see if a certificate authority name already exists by navigating to <code class="highlighter-rouge">chrome://settings/certificates</code> and checking the Authorities tab.</p>

<p><img src="/img/2018/settings-certificates-authorities.png" alt="Certificate Authorities Tab!" /></p>

<p>Here’s the command we need to run:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">openssl req <span class="nt">-x509</span> <span class="nt">-nodes</span> <span class="nt">-days</span> 365 <span class="nt">-newkey</span> rsa:2048 <span class="nt">-keyout</span> lvh_me.key <span class="nt">-out</span> lvh_me.crt <span class="nt">-config</span> /project/.ssl/openssl.cnf</code></pre></figure>

<p>Yeah, that’s a lot of information. Let’s break it down a bit from reading the <a href="https://www.openssl.org/docs/man1.0.2/">manual</a> and by running <code class="highlighter-rouge">man openssl</code>.</p>

<blockquote class="Info">
  <ul>
    <li><strong>req</strong> - "The req command primarily creates and processes certificate requests in PKCS#10 format. It can additionally create self signed certificates for use as root CAs for example."</li>
    <li><strong>-nodes</strong> - "If this option is specified then if a private key is created it will not be encrypted."</li>
    <li><strong>-x509</strong> - "This option outputs a self signed certificate instead of a certificate request."</li>
    <li><strong>-days 365</strong> - "When the -x509 option is being used this specifies the number of days to certify the certificate for. The default is 30 days."</li>
    <li><strong>-newkey arg</strong> - "This option creates a new certificate request and a new private key."</li>
    <li><strong>-keyout filename</strong> - "This gives the filename to write the newly created private key to. If this option is not specified then the filename present in the configuration file is used."</li>
    <li><strong>-out filename</strong> - "This specifies the output filename to write to or standard output by default."</li>
    <li><strong>-config filename</strong> - "This allows an alternative configuration file to be specified, this overrides the compile time filename or any specified in the OPENSSL_CONF environment variable."</li>
  </ul>
  <cite>Source: <a href="https://www.openssl.org/docs/man1.0.2/">https://www.openssl.org/docs/man1.0.2/</a></cite>
</blockquote>

<h2 id="configure-puma-for-ssl-sockets">Configure Puma for SSL Sockets</h2>

<blockquote class="Info Info-right"><strong>Segmentation fault?<br />Use puma 3.11.4</strong><br />
While using puma locally I noticed several segmentation faults on 3.10.0. In fact these occur all the way up to 3.11.3. I suggest using the current latest 3.11.4 as it appears to work as expected with SSL.
</blockquote>

<p>Puma is a powerful HTTP server for Ruby. It can be bound to specific ports, tcp, and sockets. For our purposes we’re going to use Puma’s SSL sockets. <a href="https://www.rubydoc.info/gems/puma#Binding_TCP___Sockets">For more details check out the documentation here</a></p>

<p>The following command will instruct puma to use SSL sockets with our currently untrusted certificate. Don’t worry we’ll change this in the next section.</p>

<p>Here’s the command we want to use:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Format </span>
<span class="c"># key - Private Certificate Key</span>
<span class="c"># cert - Signed Certificate</span>
rails server <span class="nt">-b</span> <span class="s1">'ssl://127.0.0.1:3000?key=/path/to/project/.ssl/lvh_me.key&amp;cert=/path/to/project/.ssl/lvh_me.crt'</span></code></pre></figure>

<p>Once you run it you should see the following logs appear in your terminal to let you know that puma is running the proper command.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">=&gt;</span> Booting Puma
<span class="o">=&gt;</span> Rails 5.0.7 application starting <span class="k">in </span>development on http://ssl://127.0.0.1:3000?key<span class="o">=</span>/path/to/project/.ssl/lvh_me.key&amp;cert<span class="o">=</span>/path/to/project/.ssl/lvh_me.crt:3000
<span class="k">*</span> Listening on ssl://127.0.0.1:3000?key<span class="o">=</span>/path/to/project/.ssl/lvh_me.key&amp;cert<span class="o">=</span>/path/to/project/.ssl/lvh_me.crt</code></pre></figure>

<h2 id="optional-performance-tip">Optional: Performance Tip</h2>

<p>Running SSL in the above format can be slow at times to load assets. Because of this I recommend that you leave the “Disable cache” option within Chrome’s network inspector unchecked. This will ensure that you only need to load an asset once instead of every request.</p>

<p><img src="/img/2018/enable-cache.png" alt="Chrome inspector network tab enable cache" /></p>

<h2 id="optional-force-all-requests-to-be-https">Optional: Force all requests to be HTTPS</h2>

<p>Rails has a <a href="https://api.rubyonrails.org/v5.2.1.1/classes/ActionDispatch/SSL.html">built-in configuration option</a> that ensures that all incoming requests are from HTTPS. We can enable this by adding the following configuration line to our <strong>/config/environments/development.rb</strong> file.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">config</span><span class="p">.</span><span class="nf">force_ssl</span> <span class="o">=</span> <span class="kp">true</span></code></pre></figure>

<p>Navigating to <strong>http://dev.lvh.me</strong> will now redirect you to <strong>https://dev.lvh.me</strong>. Neat!</p>

<h2 id="trust-certificate-in-google-chrome">Trust certificate in Google Chrome</h2>

<p>Now that we’ve generated a valid certificate we need to let Chrome know to use and trust it. For this we’ll need the <code class="highlighter-rouge">certutil</code>. This comes with <code class="highlighter-rouge">libnss3-tools</code> package.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>apt <span class="nb">install </span>libnss3-tools</code></pre></figure>

<p>Next navigate to your site (mine was https://dev.lvh.me).</p>

<p>In the browser bar there is a lock icon that indicates that https isn’t validated. Click on it and select <strong>Certificate (invalid)</strong>.</p>

<p><img src="/img/2018/insecure-connection.png" alt="Insecure connection" /></p>

<p>At this point a pop-up will display showing the current certificate. Click the <strong>Details</strong> tab.</p>

<p><img src="/img/2018/click-details.png" alt="Click certificate details tab!" /></p>

<p>On the details tab click the button <strong>Export…</strong> in the lower right side of the pop-up. You’ll see a file saving prompt. I saved mine within the above <strong>.ssl</strong> directory that we created for our project as <strong>_.lvh.me</strong>. The underscore just specifies that it is a wildcard domain (because * isn’t a valid filename character).</p>

<p>Now we can import the certificate into Chrome’s trusted authorities with the following command:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">certutil <span class="nt">-d</span> sql:<span class="nv">$HOME</span>/.pki/nssdb <span class="nt">-A</span> <span class="nt">-t</span> <span class="s2">"P,,"</span> <span class="nt">-n</span> /project/.ssl/_.lvh.me <span class="nt">-i</span> /project/.ssl/_.lvh.me</code></pre></figure>

<p>At this point you may need to restart your Rails server. Once done you should have a valid certificate and a secure connection.</p>

<p><img src="/img/2018/connection-secured.png" alt="Google Chrome secured SSL connection!" /></p>

<p>There you have it. Locally configured SSL for the lvh.me domain.</p>

<p>Know of any SSL tricks for local development? Used dnsmasq locally? How about Nginx? Is a self-signed certificate for lvh.me a bad idea? Tell me about it below in the comments.</p>



  <!-- Prev Posts -->
  <div class="Post-actions">
    
      <a class="Post-actions--prev" href="/blog/constructing-a-sql-select-from-subquery-in-activerecord/" title="Constructing a select * from subquery using ActiveRecord">&#171; Previous Post</a>
    
    
      <a class="Post-actions--next" href="/blog/using-rspec-to-set-expectations-for-stdout/" title="Using RSpec to set expectations for stdout">Next Post &#187;</a>
    
  </div>

  <!-- Comments System -->
  <div class="Comments">
    <h2>Join the conversation</h2>

    <div id="disqus_thread"></div>
  </div>

  <script type="text/javascript">
      var disqus_shortname = 'joshmfrankel';
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</article>

    </div>

    <footer class="Footer">
  <div class="Container Container-flex Container--smallMargin">
    <section class="Footer-links">
      
        
        <a href="/blog" >Blog</a>
      
        
        <a href="/blog/categories" >Categories</a>
      
        
        <a href="/blog/tags" >Tags</a>
      
        
        <a href="/blog/archives" >Archives</a>
      
        
        <a href="/" >About</a>
      
    </section>

    <section class="Footer-social flex-right">
      <a href="http://joshfrankel.me/feed" aria-label="Subscribe to my Blog" title="Subscribe to my Blog" target="_blank"><i class="fas fa-rss-square" aria-hidden="true"></i></a>
      <a href="https://github.com/joshmfrankel" aria-label="My Github profile" title="My Github profile"><i class="fab fa-github-alt" aria-hidden="true"></i></a>
      <a href="https://rubyonrails-link.slack.com/messages/@joshmfrankel/" aria-label="My Ruby on Rails Slack account" title="My Ruby on Rails Slack account"><i class="fab fa-slack-hash" aria-hidden="true"></i></a>
      <a href="https://stackoverflow.com/users/906974/josh-frankel" aria-label="My StackOverflow profile" title="My StackOverflow profile"><i class="fab fa-stack-overflow" aria-hidden="true"></i></a>
      <a href="https://twitter.com/Joshmfrankel" aria-label="My Twitter profile" title="My Twitter profile"><i class="fab fa-twitter" aria-hidden="true"></i></a>
      <a href="https://www.linkedin.com/in/joshmfrankel/" aria-label="My LinkedIn profile" title="My LinkedIn profile"><i class="fab fa-linkedin" aria-hidden="true"></i></a>
    </section>
  </div>

  <div class="Footer-actions">
    <div class="Container Container--smallMargin">
      <section>
        <h3>Latest Posts</h3>
        <nav>
          
            <a href="/blog/ordinal-abbreviations-for-dates-in-rails/">Ordinal abbreviations for dates in Rails</a>
          
            <a href="/blog/a-guide-for-upgrading-to-rails-6/">A Guide for Upgrading to Rails 6</a>
          
            <a href="/blog/a-journey-into-writing-union-queries-with-active-record/">A Journey into Writing Union queries with Active Record</a>
          
        </nav>
      </section>

      <section class="Footer-actions-copyright">
        <p>© 2011-2020+ Josh Frankel. Development Simplified. All rights reserved</p>
      </section>
    </div>
  </div>
</footer>




    
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-40607351-1', 'auto');
    ga('send', 'pageview');
  </script>


  </body>
</html>
